{% extends 'base.html' %}

{% block content %}
<link href="https://unpkg.com/tabulator-tables@4.8.3/dist/css/tabulator.min.css" rel="stylesheet">
<script type="text/javascript" src="https://unpkg.com/tabulator-tables@4.8.3/dist/js/tabulator.min.js"></script>


<h1>Status Page</h1>
<br>
<div class="row">
<div class="col">
<div class="card">
  <div class="card-header bg-primary">
    Extension information
    </div>
    <ul class="list-group">
    <li class="list-group-item">
      Total extensions in database:&nbsp;&nbsp;&nbsp;&nbsp;</h4>
      <span class="badge badge-primary badge-pill">{{es_total}}</span>
      </li>
      <li class="list-group-item">
        Total extensions on disk:&nbsp;&nbsp;&nbsp;&nbsp;</h4>
         <span class="badge badge-primary badge-pill">{{disk_total}}</span>
         </li>
  </div>
  </div>
  <div class="col">
  <div class="card">
    <div class="card-header bg-primary">
    Other Information
    </div>
    <ul class="list-group">
    <li class="list-group-item">
      Build Version:&nbsp;&nbsp;</h4>
      <span class="badge badge-primary badge-pill">{{ver}}</span>
      </li>
    </div>
    </div>
    </div>
        <br>
    <div class="row justify-content-center">
    <table id="ext_table" data-toggle="table" data-sort-name="date" data-sort-order="desc"  class="table table-striped table-bordered table-sm scan_log_table" cellspacing="0" width="100%" style="padding:5px;">
          <thead class="table-primary">
          <tr class="table-primary" style="text-align: center;">
            <th>Extension Name</th>
            <th>ID<br></th>
            <th data-field="date" data-sortable="true">Start time</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody class="table-bordered">
        {% for scan in scans %}
          <tr  class="table-dark">
            <td>{{scan['_source']['name']}}
            <td>{{scan['_source']['ext_id']}}</td>
            <td>{{scan['_source']['enqueued_at']}}</td>
            <td><span class="bg-success badge badge-primary badge-pill">Finished</span></td>
          </tr>
        {% endfor %}
        </tbody>
    </table>
    </div>
      <br>
    <div class="row justify-content-center">
    <table data-toggle="table" data-sort-name="date" data-sort-order="desc">
        <thead class="table-primary">
        <tr class="table-primary" style="text-align: center;">
          <th>Extension Name</th>
          <th>ID<br></th>
          <th data-field="date">Start time</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody class="table-bordered">
      {% if jobs|length %}
        {% for job in jobs %}
          <tr class="table-dark">
            <td>{{job[1]}}</td>
            <td style="font-size:10px;">{{job[0]['id']}}</td>
            <td>{{job[0]['enqueued_at']}}</td>
            <td><span class="bg-info badge badge-primary badge-pill">{{job[2]}}<span></td>
          </tr>
        {% endfor %}
      {% else %}
      <tr>
        <td colspan="4" style="text-align: center; vertical-align: middle;">No items currently in the queue</td>
      </tr>
      {% endif %}
      <tr>
        <td colspan="4" class="table-secondary" style="text-align: center; vertical-align: middle;">Recent Scans</td>
      </tr>
      </tbody>
    </table>
    </div>
<br>
<script type="text/javascript">
  $(document).ready(function () {
    $('#ext_table').DataTable( {
        "order": [[ 2, "desc" ]]
    } );
    $('.dataTables_length').addClass('bs-select');
});
</script>
{% endblock %}
